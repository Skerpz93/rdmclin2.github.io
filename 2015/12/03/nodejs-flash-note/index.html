<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Nodejs中connect-flash的使用 · 坐在键盘上的猫</title><meta name="description" content="Nodejs中connect-flash的使用 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/rdmclin2" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/rdmclin2" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Nodejs中connect-flash的使用</h1><div class="post-time">2015年12月3日</div><div class="post-content"><blockquote>
<p><code>connect-flash</code>是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的值使用过一次即被清空，这样的特性很方面用来做网站的提示信息。</p>
</blockquote>
<a id="more"></a>
<h1 id="connect-flash简介"><a href="#connect-flash简介" class="headerlink" title="connect-flash简介"></a>connect-flash简介</h1><p><code>connect-flash</code>是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的值使用过一次即被清空，这样的特性很方面用来做网站的提示信息。</p>
<blockquote>
<p>The flash is a special area of the session used for storing messages. Messages are written to the flash and cleared after being displayed to the user. The flash is typically used in combination with redirects, ensuring that the message is available to the next page that is to be rendered.</p>
<p>注意flash要配合session使用</p>
</blockquote>
<h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><p>首先安装<code>connect-flash</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save connect-flash</div></pre></td></tr></table></figure>
<p>然后在app.js中引入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flash = require(&apos;connect-flash&apos;);</div></pre></td></tr></table></figure>
<p>在app中使用该中间件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.use(flash());</div></pre></td></tr></table></figure>
<p>将flash中存入的变量存入res.locals变量中,例如我要在网站中使用flash中存的error和success变量，就可以把它们存入到locals变量中，这样所有的模板都可以拿到这个变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">app.use(function (req,res,next) &#123;</div><div class="line">    console.log(&quot;app.usr local&quot;);</div><div class="line">    res.locals.user = req.session.user;</div><div class="line"></div><div class="line">    var err = req.flash(&apos;error&apos;);</div><div class="line">    res.locals.error = err.length ? err: null;</div><div class="line"></div><div class="line">    var success = req.flash(&apos;success&apos;);</div><div class="line">    res.locals.success = success.length ? success : null;</div><div class="line"></div><div class="line">    next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>应用程序本地变量会附加给所有的在这个应用程序内渲染的模板。 这是一个非常有用的模板函数，就像应用程序级数据一样。app.locals 对象是一个JavaScript Function, 执行的时候它会把属性合并到它自身，提供了一种简单展示已有对象作为本地变量的方法。</p>
</blockquote>
<p>然后在页面中加入根据success和error是否存在给用户相应的提示,例如这里我们在main标签下判断success和error，如果有值，给出相应的提示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;main&gt;</div><div class="line">    &lt;% if (success) &#123; %&gt;</div><div class="line">    &lt;div class=&quot;alert alert-success&quot;&gt;</div><div class="line">        &lt;%= success %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;% &#125; %&gt;</div><div class="line">    &lt;% if (error) &#123; %&gt;</div><div class="line">    &lt;div class=&quot;alert alert-error&quot;&gt;</div><div class="line">        &lt;%= error %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;% &#125; %&gt;</div></pre></td></tr></table></figure>
<p>在页面跳转之前给success和error赋值，就可以让它们获得相应的变量，显示给用户之后，这些变量会被清空。例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">router.post(&apos;/login&apos;,function(req,res,next)&#123;</div><div class="line">    var name = req.body.username;</div><div class="line">    var password = req.body.password;</div><div class="line">    if(name === config.admin.username &amp;&amp; password === config.admin.password) &#123;</div><div class="line">        req.flash(&apos;success&apos;,&quot;登录成功!&quot;);</div><div class="line">        res.render(&apos;index&apos;, &#123;title: &quot;后台管理程序&quot;&#125;);</div><div class="line">    &#125;else&#123;</div><div class="line">        req.flash(&apos;error&apos;,&quot;用户名或密码错误&quot;);</div><div class="line">        res.redirect(&apos;/login&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/12/09/nodejs-aliyun-build-environment/" class="prev">上一篇</a><a href="/2015/11/23/nodejs-ionic-mongodb-docker-summary/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'mcl';
var disqus_identifier = '2015/12/03/nodejs-flash-note/';
var disqus_title = 'Nodejs中connect-flash的使用';
var disqus_url = 'http://www.mclspace.com/2015/12/03/nodejs-flash-note/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mcl.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://www.mclspace.com">John Doe</a>, unless otherwise noted.</p></div></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?6b26d13232555e4d64b5a8c3567ccda9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>