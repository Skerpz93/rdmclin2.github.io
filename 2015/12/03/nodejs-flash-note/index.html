<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="大猫Calvin"><title>Nodejs中connect-flash的使用 · 坐在键盘上的猫</title><meta name="description" content="connect-flash是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的值使用过一次即被清空，这样的特性很方面用来做网站的提示信息。


connect-flash简介connect-flash是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的"><meta name="keywords" content="front end, nodejs, html,css,js,android,java"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">坐在键盘上的猫</a></h3><div class="description"><p>站在艺术与技术交汇之处</p></div></div></div><ul class="social-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="http://weibo.com/rdmclin2"><i class="fa fa-weibo"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai</a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="https://avatars2.githubusercontent.com/u/4705237?v=3&amp;s=460"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Nodejs中connect-flash的使用</a></h3></div><div class="post-content"><blockquote>
<p><code>connect-flash</code>是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的值使用过一次即被清空，这样的特性很方面用来做网站的提示信息。</p>
</blockquote>
<a id="more"></a>
<h1 id="connect-flash简介"><a href="#connect-flash简介" class="headerlink" title="connect-flash简介"></a>connect-flash简介</h1><p><code>connect-flash</code>是Nodejs的一个模块，简单来说，flash是一个暂存器，而且暂存器里面的值使用过一次即被清空，这样的特性很方面用来做网站的提示信息。</p>
<blockquote>
<p>The flash is a special area of the session used for storing messages. Messages are written to the flash and cleared after being displayed to the user. The flash is typically used in combination with redirects, ensuring that the message is available to the next page that is to be rendered.</p>
<p>注意flash要配合session使用</p>
</blockquote>
<h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><p>首先安装<code>connect-flash</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save connect-flash</div></pre></td></tr></table></figure>
<p>然后在app.js中引入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flash = require(&apos;connect-flash&apos;);</div></pre></td></tr></table></figure>
<p>在app中使用该中间件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.use(flash());</div></pre></td></tr></table></figure>
<p>将flash中存入的变量存入res.locals变量中,例如我要在网站中使用flash中存的error和success变量，就可以把它们存入到locals变量中，这样所有的模板都可以拿到这个变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">app.use(function (req,res,next) &#123;</div><div class="line">    console.log(&quot;app.usr local&quot;);</div><div class="line">    res.locals.user = req.session.user;</div><div class="line"></div><div class="line">    var err = req.flash(&apos;error&apos;);</div><div class="line">    res.locals.error = err.length ? err: null;</div><div class="line"></div><div class="line">    var success = req.flash(&apos;success&apos;);</div><div class="line">    res.locals.success = success.length ? success : null;</div><div class="line"></div><div class="line">    next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>应用程序本地变量会附加给所有的在这个应用程序内渲染的模板。 这是一个非常有用的模板函数，就像应用程序级数据一样。app.locals 对象是一个JavaScript Function, 执行的时候它会把属性合并到它自身，提供了一种简单展示已有对象作为本地变量的方法。</p>
</blockquote>
<p>然后在页面中加入根据success和error是否存在给用户相应的提示,例如这里我们在main标签下判断success和error，如果有值，给出相应的提示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;main&gt;</div><div class="line">    &lt;% if (success) &#123; %&gt;</div><div class="line">    &lt;div class=&quot;alert alert-success&quot;&gt;</div><div class="line">        &lt;%= success %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;% &#125; %&gt;</div><div class="line">    &lt;% if (error) &#123; %&gt;</div><div class="line">    &lt;div class=&quot;alert alert-error&quot;&gt;</div><div class="line">        &lt;%= error %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;% &#125; %&gt;</div></pre></td></tr></table></figure>
<p>在页面跳转之前给success和error赋值，就可以让它们获得相应的变量，显示给用户之后，这些变量会被清空。例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">router.post(&apos;/login&apos;,function(req,res,next)&#123;</div><div class="line">    var name = req.body.username;</div><div class="line">    var password = req.body.password;</div><div class="line">    if(name === config.admin.username &amp;&amp; password === config.admin.password) &#123;</div><div class="line">        req.flash(&apos;success&apos;,&quot;登录成功!&quot;);</div><div class="line">        res.render(&apos;index&apos;, &#123;title: &quot;后台管理程序&quot;&#125;);</div><div class="line">    &#125;else&#123;</div><div class="line">        req.flash(&apos;error&apos;,&quot;用户名或密码错误&quot;);</div><div class="line">        res.redirect(&apos;/login&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2015-12-03</span><i class="fa fa-comment-o"></i><a href="/2015/12/03/nodejs-flash-note/#comments">评论</a><i class="fa fa-tag"></i><a href="/categories/nodejs/" title="nodejs" class="tag">nodejs </a><a href="/tags/express/" title="express" class="tag">express </a></div></div></div></div><div class="share"><div class="evernote"> <a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"> <a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"> <a href="http://twitter.com/home?status=,http://www.mclspace.com/2015/12/03/nodejs-flash-note/,坐在键盘上的猫,Nodejs中connect-flash的使用,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2015/12/09/nodejs-aliyun-build-environment/" title="在阿里云上搭建Nodejs开发环境" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2015/11/23/nodejs-ionic-mongodb-docker-summary/" title="Nodejs+Ionic+Mongodb+Docker技术综述" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div data-thread-key="2015/12/03/nodejs-flash-note/" data-title="Nodejs中connect-flash的使用" data-url="http://www.mclspace.com/2015/12/03/nodejs-flash-note/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"coco"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>